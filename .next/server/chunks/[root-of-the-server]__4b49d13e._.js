module.exports=[54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},71815,(e,t,r)=>{t.exports=e.x("sharp",()=>require("sharp"))},60198,e=>{"use strict";let t;var r,n,o,a,s,i,l=e.i(47909),u=e.i(74017),p=e.i(96250),c=e.i(59756),d=e.i(61916),g=e.i(14444),f=e.i(37092),h=e.i(69741),y=e.i(16795),m=e.i(87718),R=e.i(95169),w=e.i(47587),E=e.i(66012),O=e.i(70101),b=e.i(26937),C=e.i(10372),v=e.i(93695);e.i(52474);var N=e.i(220),S=e.i(89171),T=e.i(54799),x=e.i(874),_=e.i(71815),P=e.i(81769);let A=process.env.MONGODB_URI;if(!A)throw Error("Missing MONGODB_URI. Add it to your environment configuration (e.g. .env.local).");let B=globalThis;async function I(){return t}async function M(){let e=await I(),t=process.env.MONGODB_DB||"sspl",r=process.env.MONGODB_COLLECTION||"submissions";return e.db(t).collection(r)}async function j(e){let t=await M();await t.insertOne(e)}B._mongoClientPromise||(B._mongoClientPromise=new P.MongoClient(A,{}).connect()),t=B._mongoClientPromise;var D=e.i(59485);e.i(14747),(r=a||(a={})).PROFILE="profile",r.SSO_SESSION="sso-session",r.SERVICES="services",e.i(46786);let{readFile:U}=e.i(22734).promises,q={},k={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();1===t.length&&(t=`0${t}`),q[e]=t,k[t]=e}(n=s||(s={}))[n.boolTrue=0]="boolTrue",n[n.boolFalse=1]="boolFalse",n[n.byte=2]="byte",n[n.short=3]="short",n[n.integer=4]="integer",n[n.long=5]="long",n[n.byteArray=6]="byteArray",n[n.string=7]="string",n[n.timestamp=8]="timestamp",n[n.uuid=9]="uuid";(o=i||(i={})).ENV="env",o.CONFIG="shared config entry";let $=process.env.B2_S3_ENDPOINT,K=process.env.B2_S3_REGION||"us-east-005",F=process.env.B2_KEY_ID,H=process.env.B2_APPLICATION_KEY,L=process.env.B2_BUCKET;if(process.env.B2_SIGNED_URL_TTL,!$)throw Error("Missing B2_S3_ENDPOINT in environment configuration.");if(!F||!H)throw Error("Missing Backblaze B2 credentials (B2_KEY_ID/B2_APPLICATION_KEY).");if(!L)throw Error("Missing Backblaze B2 bucket (B2_BUCKET).");let z=new D.S3Client({endpoint:$,region:K,credentials:{accessKeyId:F,secretAccessKey:H},forcePathStyle:!0});async function G({key:e,body:t,contentType:r,metadata:n}){if(!e)throw Error("uploadObject requires a key.");if(!t)throw Error("uploadObject requires a body.");let o=new D.PutObjectCommand({Bucket:L,Key:e,Body:t,ContentType:r,Metadata:n});return await z.send(o),e}let J=process.env.OCR_SPACE_ENDPOINT??"https://api.ocr.space/parse/image",Y="image/jpeg";function V(e){return e?.replace(/[^a-z0-9.\-_]/gi,"_").toLowerCase()||"upload"}function W(e,t){let r=V(e).replace(/\.[^.]+$/,"")||t;return`${r}.jpg`}function X(e,t){let r=V(t),n=`${Date.now()}-${T.default.randomUUID()}`;return`${e}/${n}-${r}`}function Z(e){let t=e?.type?.toLowerCase();if(t?.startsWith("image/"))return!0;let r=e?.name?.toLowerCase()??"";return/\.(jpg|jpeg|png|webp|heic|heif|gif)$/.test(r)}async function Q(e){let t=80,r=1600,n=await (0,_.default)(e).rotate().resize({width:r,withoutEnlargement:!0}).jpeg({quality:t}).toBuffer();for(;n.length>1048576&&t>40;)t-=10,n=await (0,_.default)(e).rotate().resize({width:r,withoutEnlargement:!0}).jpeg({quality:t}).toBuffer();for(;n.length>1048576&&r>640;)r=Math.max(640,Math.round(.8*r)),n=await (0,_.default)(e).rotate().resize({width:r,withoutEnlargement:!0}).jpeg({quality:t}).toBuffer();if(n.length>1048576)throw Error("Unable to compress image under 1 MB.");return{buffer:n,contentType:Y}}async function ee(e,t,r){let n,o=process.env.OCR_SPACE_API_KEY;if(!o)throw Error("OCR_SPACE_API_KEY is not configured.");console.log("[Registration] Starting OCR request",JSON.stringify({endpoint:J,filename:t,payloadBytes:e.length}));let a=new FormData;a.append("apikey",o),a.append("language","eng"),a.append("isOverlayRequired","false"),a.append("scale","true"),a.append("OCREngine","5");let s=W(t,"payment"),i=new x.Blob([e],{type:r||Y});a.append("file",i,s);let l=new AbortController,u=setTimeout(()=>l.abort(),2e4);try{n=await fetch(J,{method:"POST",body:a,signal:l.signal})}catch(e){throw console.error("[Registration] OCR request failed to send",e),Error("Failed to reach the OCR service. Please try again.")}finally{clearTimeout(u)}if(console.log("[Registration] OCR response status",JSON.stringify({status:n.status,statusText:n.statusText})),!n.ok)throw console.error("[Registration] OCR non-OK response body",await n.text()),Error(`OCR request failed with status ${n.status} ${n.statusText}`);let p=await n.json();if(console.log("[Registration] OCR payload snapshot",JSON.stringify({isErrored:p.IsErroredOnProcessing,errorMessage:p.ErrorMessage,parsedResultsCount:p.ParsedResults?.length??0})),p.IsErroredOnProcessing){let e=Array.isArray(p.ErrorMessage)?p.ErrorMessage.join("; "):p.ErrorMessage||"OCR processing failed.";throw console.error("[Registration] OCR reported processing error",e),Error(e)}let c=p.ParsedResults?.map(e=>e.ParsedText).join("\n")??"";return console.log("[Registration] OCR text preview",JSON.stringify({length:c.length,snippet:c.slice(0,200)})),c}async function et(e){let t=await e.formData(),r=t.get("name")?.toString().trim(),n=t.get("address")?.toString().trim(),o=t.get("playerType")?.toString(),a=t.get("playerTypeOther")?.toString().trim(),s=t.get("tshirtSize")?.toString(),i=t.get("jerseyName")?.toString().trim(),l=t.get("jerseyNumber")?.toString().trim(),u=t.get("foodType")?.toString(),p=t.get("foodTypeOther")?.toString().trim(),c=t.get("photo"),d=t.get("paymentScreenshot");if(!r||!n||!o||!s||!i||!l||!u||!(c instanceof File)||!(d instanceof File))return S.NextResponse.json({error:"Please complete all required fields with valid uploads."},{status:400});if(!Z(c)||!Z(d))return S.NextResponse.json({error:"Only image files are accepted for photo and payment proof."},{status:400});if(c.size>0xa00000||d.size>0xa00000)return S.NextResponse.json({error:"Images must be 10 MB or smaller before upload."},{status:413});if("other"===o&&!a)return S.NextResponse.json({error:"Please specify your player type."},{status:400});if("other"===u&&!p)return S.NextResponse.json({error:"Please specify your food preference."},{status:400});try{let e=Buffer.from(await c.arrayBuffer()),t=Buffer.from(await d.arrayBuffer());console.log("[Registration] Raw upload sizes",JSON.stringify({photoBytes:e.length,paymentBytes:t.length}));let g=await Q(e),f=await Q(t);console.log("[Registration] Compressed sizes",JSON.stringify({photoBytes:g.buffer.length,paymentBytes:f.buffer.length}));let h=await ee(f.buffer,d.name,f.contentType);if(!function(e){if(!e)return!1;let t=e.toLowerCase().replace(/o/g,"0");if(t.replace(/[^0-9]/g,"").includes("900")||t.includes("₹900")||t.includes("rs 900"))return!0;let r=t.replace(/[,₹]/g,"");if([/\b900(?:\.00)?\b/,/\b900\/-\b/,/\brs\.?\s*900(?:\.00)?\b/,/\binr\.?\s*900(?:\.00)?\b/,/\bamount\s*:?\.?\s*900(?:\.00)?\b/,/\bamount\s*:?\.?\s*rs\.?\s*900(?:\.00)?\b/].some(e=>e.test(r)))return console.log("[Registration] OCR regex matched 900"),!0;let n=function(e){let t,r=[],n=/(?:₹|rs\.?|inr\.?|amount|paid|payment|total)\s*[:=]?\s*([0-9]+(?:[.,][0-9]+)?)/gi;for(;null!==(t=n.exec(e));){let e=Number.parseFloat(t[1].replace(/,/g,""));Number.isNaN(e)||r.push(e)}let o=/\b([0-9]{2,6})(?:[.,][0-9]{2})?\b/g;for(;null!==(t=o.exec(e));){let e=Number.parseFloat(t[1]);Number.isNaN(e)||r.push(e)}return r}(t);return console.log("[Registration] OCR extracted amounts",JSON.stringify({amounts:n})),n.some(e=>1>=Math.abs(e-900))}(h))return console.warn("[Registration] OCR could not validate 900 payment",JSON.stringify({ocrTextSnippet:h.slice(0,200)})),S.NextResponse.json({error:"Unable to confirm the ₹900 payment from the screenshot. Please ensure the amount is clearly visible."},{status:422});let y=await G({key:X("photos",W(c.name,"photo")),body:g.buffer,contentType:g.contentType,metadata:{originalname:V(c.name||"photo"),originaltype:c.type||""}}),m=await G({key:X("payments",W(d.name,"payment")),body:f.buffer,contentType:f.contentType,metadata:{originalname:V(d.name||"payment"),originaltype:d.type||""}}),R={id:T.default.randomUUID(),createdAt:new Date().toISOString(),name:r,address:n,playerType:o,playerTypeOther:"other"===o?a:"",tshirtSize:s,jerseyName:i,jerseyNumber:l,foodType:u,foodTypeOther:"other"===u?p:"",photoKey:y,photoContentType:g.contentType,paymentScreenshotKey:m,paymentContentType:f.contentType,ocrText:h};return await j(R),S.NextResponse.json({success:!0,submissionId:R.id},{status:201})}catch(r){console.error("Registration error",r);let e=r instanceof Error?r.message:"Unexpected upload error.",t="Unable to compress image under 1 MB."===e?413:500;return S.NextResponse.json({error:413===t?e:"Something went wrong while processing the registration."},{status:t})}}e.s(["POST",()=>et],50174);var er=e.i(50174);let en=new l.AppRouteRouteModule({definition:{kind:u.RouteKind.APP_ROUTE,page:"/api/register/route",pathname:"/api/register",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/register/route.js",nextConfigOutput:"",userland:er}),{workAsyncStorage:eo,workUnitAsyncStorage:ea,serverHooks:es}=en;function ei(){return(0,p.patchFetch)({workAsyncStorage:eo,workUnitAsyncStorage:ea})}async function el(e,t,r){en.isDev&&(0,c.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/register/route";n=n.replace(/\/index$/,"")||"/";let o=await en.prepare(e,t,{srcPage:n,multiZoneDraftMode:!1});if(!o)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:a,params:s,nextConfig:i,parsedUrl:l,isDraftMode:p,prerenderManifest:S,routerServerContext:T,isOnDemandRevalidate:x,revalidateOnlyGenerated:_,resolvedPathname:P,clientReferenceManifest:A,serverActionsManifest:B}=o,I=(0,h.normalizeAppPath)(n),M=!!(S.dynamicRoutes[I]||S.routes[P]),j=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,l,!1):t.end("This page could not be found"),null);if(M&&!p){let e=!!S.routes[P],t=S.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(i.experimental.adapterPath)return await j();throw new v.NoFallbackError}}let D=null;!M||en.isDev||p||(D="/index"===(D=P)?"/":D);let U=!0===en.isDev||!M,q=M&&!U;B&&A&&(0,g.setReferenceManifestsSingleton)({page:n,clientReferenceManifest:A,serverActionsManifest:B,serverModuleMap:(0,f.createServerModuleMap)({serverActionsManifest:B})});let k=e.method||"GET",$=(0,d.getTracer)(),K=$.getActiveScopeSpan(),F={params:s,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!i.experimental.authInterrupts},cacheComponents:!!i.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,c.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:i.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n)=>en.onRequestError(e,t,n,T)},sharedContext:{buildId:a}},H=new y.NodeNextRequest(e),L=new y.NodeNextResponse(t),z=m.NextRequestAdapter.fromNodeNextRequest(H,(0,m.signalFromNodeResponse)(t));try{let o=async e=>en.handle(z,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=$.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==R.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=r.get("next.route");if(o){let t=`${k} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${n}`)}),a=!!(0,c.getRequestMeta)(e,"minimalMode"),s=async s=>{var l,c;let d=async({previousCacheEntry:i})=>{try{if(!a&&x&&_&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(s);e.fetchMetrics=F.renderOpts.fetchMetrics;let l=F.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let u=F.renderOpts.collectedTags;if(!M)return await (0,E.sendResponse)(H,L,n,F.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,O.toNodeOutgoingHttpHeaders)(n.headers);u&&(t[C.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=C.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,o=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=C.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:N.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:o}}}}catch(t){throw(null==i?void 0:i.isStale)&&await en.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,w.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:x})},T),t}},g=await en.handleResponse({req:e,nextConfig:i,cacheKey:D,routeKind:u.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:x,revalidateOnlyGenerated:_,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:a});if(!M)return null;if((null==g||null==(l=g.value)?void 0:l.kind)!==N.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==g||null==(c=g.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});a||t.setHeader("x-nextjs-cache",x?"REVALIDATED":g.isMiss?"MISS":g.isStale?"STALE":"HIT"),p&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,O.fromNodeOutgoingHttpHeaders)(g.value.headers);return a&&M||f.delete(C.NEXT_CACHE_TAGS_HEADER),!g.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,b.getCacheControlHeader)(g.cacheControl)),await (0,E.sendResponse)(H,L,new Response(g.value.body,{headers:f,status:g.value.status||200})),null};K?await s(K):await $.withPropagatedContext(e.headers,()=>$.trace(R.BaseServerSpan.handleRequest,{spanName:`${k} ${n}`,kind:d.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},s))}catch(t){if(t instanceof v.NoFallbackError||await en.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,w.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:x})}),M)throw t;return await (0,E.sendResponse)(H,L,new Response(null,{status:500})),null}}e.s(["handler",()=>el,"patchFetch",()=>ei,"routeModule",()=>en,"serverHooks",()=>es,"workAsyncStorage",()=>eo,"workUnitAsyncStorage",()=>ea],60198)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__4b49d13e._.js.map